---
title: "plots with prolactin"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(cowplot)
library(magick)
library(png)
library(grid)
library("ggimage")

source("../R/themes.R") 
source("../R/functions.R")
source("../R/icons.R")

knitr::opts_chunk$set(fig.path = '../figures/PRL/',message=F, warning=FALSE)
```


```{r data}
hormones <- read_csv("../results/hormones.csv")
hormones$treatment <- factor(hormones$treatment, levels = alllevels)
```



```{r hormone}
p1 <- hormones %>% 
    filter(study == "characterization", hormone %in% c("prolactin"))  %>% 
    droplevels() %>% 
  ggplot(aes(x = treatment, y = plasma_conc, fill = treatment)) +
    geom_boxplot() +
  ylim(c(-10,120)) + 
    mytheme() +
  #theme(axis.text.x = element_blank()) + 
  theme(legend.position = "none") + 
  labs(x = "parental care stages", y = "prolactin conc. (ng/mL)") +
  annotation_custom(control, ymin = -20, ymax = 0, xmin = -7.5) +
  annotation_custom(bldg, ymin = -20, ymax = 0, xmin = -5.5) +
  annotation_custom(lay, ymin = -20, ymax = 0, xmin = -3.5) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = -1.5) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = 0.5) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = 2.5) +
  annotation_custom(hatch, ymin = -20, ymax = 0, xmin = 4.5) +
  annotation_custom(nestling, ymin = -20, ymax = 0, xmin = 6.5) +
  annotation_custom(nestling, ymin = -20, ymax = 0, xmin = 8.5) 
p1


meanPRL <- hormones %>% 
    filter(study == "characterization", hormone %in% c("prolactin"))  %>% 
    droplevels() %>% 
  dplyr::group_by(treatment) %>%
  dplyr::summarise(m = mean(plasma_conc), 
                   se = sd(plasma_conc)/sqrt(length(plasma_conc))) %>%
  dplyr::mutate(m = round(m,0)) 
meanPRL <- left_join(meanPRL, birds)
meanPRL$treatment <- factor(meanPRL$treatment, levels = alllevels)
meanPRL

ggplot(meanPRL, aes(treatment, m)) +
  geom_errorbar(aes(ymin=m-se, ymax=m+se), width=.1) +
   geom_image(aes(image=iconpath), size=.12)  +
  labs(x = "parental care stages", y = "Prolactin (ng/mL)")

ggplot(meanPRL, aes(treatment, m)) +
   geom_image(aes(image=music), size=.12)  +
  labs(x = "parental care stages", y = "Prolactin (ng/mL)")  +
  mytheme() +
  ylim(c(-15,80)) +
  annotation_custom(control, ymin = -20, ymax = 0, xmin = -7.5) +
  annotation_custom(bldg, ymin = -20, ymax = 0, xmin = -5.5) +
  annotation_custom(lay, ymin = -20, ymax = 0, xmin = -3.5) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = -1.5) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = 0.5) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = 2.5) +
  annotation_custom(hatch, ymin = -20, ymax = 0, xmin = 4.5) +
  annotation_custom(nestling, ymin = -20, ymax = 0, xmin = 6.5) +
  annotation_custom(nestling, ymin = -20, ymax = 0, xmin = 8.5) 


p2 <- hormones %>% 
    filter(study == "characterization", hormone %in% c("prolactin"))  %>% 
    droplevels() %>% 
  ggplot(aes(x = as.numeric(treatment), y = plasma_conc)) +
        geom_smooth(aes(colour = sex)) +
    geom_boxplot(aes(fill = treatment, alpha = sex)) +
    mytheme() +
    theme(axis.text.x = element_blank()) +
    scale_fill_manual(values = colorscharmaip) +
    scale_color_manual(values = sexcolors) +
    labs(y = "prolactin conc. (ng/mL)", x = NULL) +
    guides(fill = FALSE, alpha = FALSE,
         color = guide_legend(order=1)) +
    scale_alpha_manual(values = c(0.75,1)) +
    theme(legend.position = c(0.85,0.15), legend.direction = "horizontal") + 
  labs(x = "parental care stages", y = "prolactin conc. (ng/mL)") +
  annotation_custom(control, ymin = -20, ymax = 0, xmin = -7.8) +
  annotation_custom(bldg, ymin = -20, ymax = 0, xmin = -5.8) +
  annotation_custom(lay, ymin = -20, ymax = 0, xmin = -3.8) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = -1.8) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = 0.6) +
  annotation_custom(inc, ymin = -20, ymax = 0, xmin = 2.4) +
  annotation_custom(hatch, ymin = -20, ymax = 0, xmin = 4.4) +
  annotation_custom(nestling, ymin = -20, ymax = 0, xmin = 6.4) +
  annotation_custom(nestling, ymin = -20, ymax = 0, xmin = 8.4) + 
  ylim(c(-10,120)) 
p2
```


```{r PRL.pit}
vsd.pit <- readvsd("../results/04_vsd_pit.csv")
colData.pit <- readcolData("../results/04_colData_pit.csv")

geneinfo <- read_csv("../metadata/00_geneinfo.csv") %>%  dplyr::select(Name, geneid, entrezid) %>% arrange(Name)
candidategenes <- c("PRL")
candidates.pit <- selectcandidatevsds(candidategenes, vsd.pit, colData.pit)

p3 <- ggplot(candidates.pit, aes(x = as.numeric(treatment), y = PRL)) + 
        geom_smooth(aes(colour = sex)) +
    geom_boxplot(aes(fill = treatment, alpha = sex)) + 
    scale_alpha_manual(values = c(0.75,1)) +
    mytheme() +
  theme(legend.position = c(0.85,0.2), legend.direction = "horizontal") + 
  scale_color_manual(values = c("female" = "#969696", "male" = "#525252")) +
    labs(y = "PRL expression in the pituitary", x = "parental care stage") +
    scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                       labels = charlevels) +
  annotation_custom(control, ymin = 12, ymax = 14, xmin = -7.8) +
  annotation_custom(bldg, ymin = 12, ymax = 14, xmin = -5.8) +
  annotation_custom(lay, ymin = 12, ymax = 14, xmin = -3.8) +
  annotation_custom(inc, ymin = 12, ymax = 14, xmin = -1.8) +
  annotation_custom(inc, ymin = 12, ymax = 14, xmin = 0.6) +
  annotation_custom(inc, ymin = 12, ymax = 14, xmin = 2.4) +
  annotation_custom(hatch, ymin = 12, ymax = 14, xmin = 4.4) +
  annotation_custom(nestling, ymin = 12, ymax = 14, xmin = 6.4) +
  annotation_custom(nestling, ymin = 12, ymax = 14, xmin = 8.4)  + 
  ylim(c(13,24)) +
  guides(fill = FALSE, alpha = FALSE, color = guide_legend(order=1)) 
p3

candidates.pit

meanPRL <- candidates.pit %>% 
    droplevels() %>% 
  dplyr::group_by(treatment) %>%
  dplyr::summarise(m = mean(PRL), 
                   se = sd(PRL)/sqrt(length(PRL))) %>%
  dplyr::mutate(m = round(m,0)) 
meanPRL <- left_join(meanPRL, birds)
meanPRL$treatment <- factor(meanPRL$treatment, levels = alllevels)
meanPRL

ggplot(meanPRL, aes(treatment, m)) +
  geom_errorbar(aes(ymin=m-se, ymax=m+se), width=.1) +
   geom_image(aes(image=iconpath), size=.12)  +
  labs(x = "parental care stages", y = "Pituitary PRL expression")

ggplot(meanPRL, aes(treatment, m)) +
   geom_image(aes(image=music), size=.12)  +
  labs(x = "parental care stages", y = "Pituitary PRL expression") +
  mytheme() +
  ylim(c(15,22)) +
  annotation_custom(control, ymin = 15, ymax = 16.5, xmin = -7.5) +
  annotation_custom(bldg, ymin = 15, ymax = 16.5, xmin = -5.5) +
  annotation_custom(lay, ymin = 15, ymax = 16.5, xmin = -3.5) +
  annotation_custom(inc, ymin = 15, ymax = 16.5, xmin = -1.5) +
  annotation_custom(inc, ymin = 15, ymax = 16.5, xmin = 0.5) +
  annotation_custom(inc, ymin = 15, ymax = 16.5, xmin = 2.5) +
  annotation_custom(hatch, ymin = 15, ymax = 16.5, xmin = 4.5) +
  annotation_custom(nestling, ymin = 15, ymax = 16.5, xmin = 6.5) +
  annotation_custom(nestling, ymin = 15, ymax = 16.5, xmin = 8.5) 
```