---
title: "Fig3"
output: md_document
---

# Figure 4: All things prolactin

```{r setup}
library(tidyverse)
library(cowplot)
library(ggimage)
library(apaTables)
library(factoextra)
library(corrr)
library(ggpubr)
library(ggrepel)
library(ggsignif)

source("../R/themes.R") 
source("../R/functions.R")

knitr::opts_chunk$set(fig.path = '../figures/',message=F, warning=FALSE)
```

## import limma counts and sample info

```{r data}
countData <- read_csv("../results/01_limma.csv") %>%
  column_to_rownames(var = "X1")
countData <- as.data.frame(t(countData))
head(countData[1:3])

colData <- read_csv("../metadata/00_colData.csv") %>%
  mutate(treatment = factor(treatment, levels = alllevels),
         tissue = factor(tissue, levels = tissuelevels)) %>% 
  column_to_rownames(var = "X1") 
head(colData)
# check ready for analysis
# row.names(countData) == row.names(colData)
head(row.names(countData) == row.names(colData))
```


## PCA data

```{r PCA}
# pca relies on count data from limma

pca1f <- subsetmakepca("pituitary", charlevels, "female")	
pca2f <- makefvizdf("pituitary", charlevels, "female")	

pca1m <- subsetmakepca("pituitary", charlevels, "male")	
pca2m <- makefvizdf("pituitary", charlevels, "male")

pca1 <- subsetmakepca("pituitary", charlevels, sexlevels)	
pca2 <- makefvizdf("pituitary", charlevels, sexlevels)	
```






```{r fig3, fig.width=7.25, fig.height=7.25}

a1 <- plotpc12(pca1, pca2, pca1$treatment, allcolors, "Pituitary gene expression", " ")   
a2 <- plotprolactin(PRLpit, PRLpit$counts, "PRL", " ") + 
  theme(axis.text.x = element_text())  +
  theme(legend.position = c(0.8,0.2)) + 
  guides(fill = FALSE)

a <- plot_grid(a1,a2, labels = c("A"), label_size = 8)


b1 <- png::readPNG("../figures/images/fig_fig3b.png")
b1 <- ggdraw() +  draw_image(b1, scale = 1)


b2 <- makenewbargraph("pituitary", "female","eggs vs. chicks", 0, 2200) + labs(subtitle = "female")  + labs(title = " ")  
b3 <- makenewbargraph("pituitary", "male", "eggs vs. chicks", 0, 2200)  + labs(subtitle = "male")  + labs(title = " ") +
  theme(axis.title.y = element_blank(), axis.ticks.y = element_blank(), 
        axis.text.y = element_blank(), axis.line.y = element_blank())

b4 <- makenewbargraph("pituitary", "male", "lo vs. hi PRL   ", 0, 2200) 
b5 <- makenewbargraph("pituitary", "female", "lo vs. hi PRL   ", 0, 2200)   + 
  theme(axis.title.y = element_blank(), axis.ticks.y = element_blank(), 
        axis.text.y = element_blank(), axis.line.y = element_blank())

b25 <- plot_grid(b2,b3,b4,b5, nrow = 2, rel_widths = c(1.2,1), rel_heights = c(1.2,1))

b6 <-  plottopDEGs(envDEGs, "female", "#3A80B9", "LFC eggs vs. chicks", "Top 10 female DEGs") + labs(title = " ")
b7 <-  plottopDEGs(PRLDEGs, "male", "#3A80B9", "LFC eggs vs. chicks", "Top 10 male DEGs") + labs(title = " ")
b8 <-  plottopDEGs(PRLDEGs, "female", "#19757A", "LFC lo vs. hi PRL", NULL)
b9 <-  plottopDEGs(PRLDEGs, "male", "#19757A", "LFC lo vs. hi PRL", NULL)


b15 <- plot_grid(b1,b25,nrow = 1, rel_widths = c(1.2,1))
b69 <- plot_grid(b6,b7,b8,b9, align = "v" , rel_heights = c(1.2,1))
b <- plot_grid(b15,b69, labels = c("B"), label_size = 8, rel_widths = c(1.2,1))

c1 <- plotcorrplot(piteggchick, NULL) + theme(legend.position = "none") + labs(subtitle = "Top 20 eggs vs. chicks DEGs")
c2 <- plotcorrplot(pithilo, NULL) + theme(legend.position = "none") + labs(subtitle = "Top 20 lo vs. PRL DEGs") 
d <- plotcorrplot(pitWGCNA, NULL) + theme(legend.position = "none") + labs(subtitle = "20 genes from WGCNA module with PRL") + theme(legend.position = "right")

cd <- plot_grid(c1,c2,d, nrow = 1, align = "h", labels = c("C", "", "D"), label_size = 8, rel_widths = c(1,1,1.3))


fig3 <- plot_grid(a, b, cd, nrow = 3, rel_heights = c(1.2,2,1.8))
fig3


pdf(file="../figures/fig3-1.pdf", width=7.25, height=7.25)
plot(fig3)
dev.off()
```
 
```{r savefiles}
write.csv(PRLpit,"../results/PRLvsd.csv", row.names = F)

```