---
title: "Fig3: Correlations in gene expression"
author: "Rayna M Harris"
date: "3/26/2020"
output: md_document
---


# Correlations in gene expression

```{r setup}
library(tidyverse)
library(cowplot)
library(corrr)
library(ggpubr)

source("../R/themes.R")
source("../R/functions.R")
source("../R/wrangledata.R")

knitr::opts_chunk$set(echo = TRUE, message = F, fig.path = "../figures/")
```

## data wrangle


```{r data}

# load `candidatevsd` with `source("../R/wrangledata.R")`
head(candidatevsd)

curleychampagnegenes <- curleychampagnegenes %>% pull(gene)

# widen for correlations 

c1 <- makecorrdf("female", "hypothalamus", curleychampagnegenes)  
c2 <- makecorrdf("female", "pituitary", curleychampagnegenes)  
c3 <- makecorrdf("female", "gonad", curleychampagnegenes)  

c4 <- makecorrdf("male", "hypothalamus", curleychampagnegenes)  
c5 <- makecorrdf("male", "pituitary", curleychampagnegenes)  
c6 <- makecorrdf("male", "gonad", curleychampagnegenes)  

candidatevsdwide <- candidatevsd  %>%
    pivot_wider(names_from = gene, values_from = counts) 
head(candidatevsdwide)

FH <- subsetcandidatevsdwide("female", "hypothalamus")
FP <- subsetcandidatevsdwide("female", "pituitary")
FG <- subsetcandidatevsdwide("female", "gonad")
MH <- subsetcandidatevsdwide("male", "hypothalamus")
MP <- subsetcandidatevsdwide("male", "pituitary")
MG <- subsetcandidatevsdwide("male", "gonad") 
```



### figure


```{r fig3, fig.width = 7.25, fig.height = 7.25}

p1 <- plotcorrplot(c1, "FH") + theme(legend.position = "none", axis.text.x = element_blank()) + labs(subtitle = "Hypothalamus")
p2 <- plotcorrplot(c2, "FP") + theme(legend.position = "none", axis.text.x = element_blank()) + 
  labs(subtitle = "Pituitary") 
p3 <- plotcorrplot(c3, "FG") + theme(legend.position = "none") + labs(subtitle = "Gonad")  

p4 <- plotcorrplot(c4, "MH") + theme(legend.position = "none", axis.text.y = element_blank(), axis.text.x = element_blank()) + labs(subtitle = " ")
p5 <- plotcorrplot(c5, "MP") + theme(legend.position = "none", axis.text.y = element_blank(), axis.text.x = element_blank())  +
  labs(subtitle = " ") 
p6 <- plotcorrplot(c6, " ") + theme(legend.position = "none", axis.text.y = element_blank()) + labs(subtitle = " ") 

a <- plot_grid(p1 + labs(title = "Female"),
               p4 + labs(title = "Male"),
               p2, p5, p3, p6, nrow = 3, rel_widths = c(1.2,1),
               rel_heights = c(1,1,1.2))

scattercorrelations <- function(df, gene1, gene2, mylinecolor, myxlab, myylab){
  p <- ggplot(df, aes(x = gene1, y = gene2)) +
    labs(subtitle = " ", x = myxlab, y = myylab) + 
    scale_color_manual(values = allcolors) +
    geom_smooth(method = "lm",  color = mylinecolor) +
    geom_point(aes(color = treatment))  +
    theme_B3() +  
    theme(axis.title = element_text(face = "italic"), 
            legend.position = "none") +
    stat_cor( size = 2)
  return(p)
}


# "female" = "#969696", "male" = "#525252"

p7 <- scattercorrelations(FH, FH$DRD1, FH$HTR2C, "#969696", "DRD1", "HTR2C") + labs(subtitle = "Hypothalamus")
p8 <- scattercorrelations(FP, FP$AVPR1A, FP$CRHR1, "#969696", "AVPR1A", "CRHR1")  + labs(subtitle = "Pituitary")
p9 <- scattercorrelations(FG, FG$ESR2, FG$CRHBP, "#969696", "ESR2", "CRHBP")   + labs(subtitle = "Gonad")

p10 <- scattercorrelations(MH, MH$DRD1, MH$HTR2C, "#525252", "DRD1", "HTR2C") + theme(axis.title.y = element_blank())
p11 <- scattercorrelations(MP, MP$AVPR1A, MP$CRHR1, "#525252", "AVPR1A", "CRHR1") + theme(axis.title.y = element_blank())
p12 <- scattercorrelations(MG, MG$ESR2, MG$CRHBP, "#525252", "ESR2", "CRHBP")  + theme(axis.title.y = element_blank())

b <- plot_grid(p7 + labs(title = "Female"), 
               p10 + labs(title = "Male"), 
               p8, p11, p9, p12, nrow = 3, rel_heights = c(1,1,1.2))

ab <- plot_grid(a,b, rel_widths = c(1.5,1), labels = c("A", "B"), label_size = 8)


p13 <- plotcorrplot(c1, "FH") + theme(legend.position = "bottom")
p14 <- scattercorrelations(FH, FH$DRD1, FH$HTR2C, "#969696", "DRD1", "HTR2C") + 
  theme(legend.position = "bottom",
        legend.title = element_blank())

legend1 <- p13 %>% get_legend()
legend2 <- p14 %>% get_legend()

legends <- plot_grid(legend1, legend2, rel_widths = c(1.5,1))

plot_grid(ab, legends, nrow = 2, rel_heights = c(1,0.1))

```