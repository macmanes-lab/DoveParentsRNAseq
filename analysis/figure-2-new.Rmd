---
title: "Fig 2"
output: md_document
---

# Fig 2

```{r setup, include=T}
library(tidyverse)
library(cowplot)
library(ggsignif)

source("../R/themes.R")
source("../R/functions.R")

knitr::opts_chunk$set(echo = TRUE, fig.path = '../figures/')
```

## Treatment specific DEGs 

```{r suppltables}
allDEG <- read_csv("../results/03_allDEG.csv") %>%
  mutate(tissue = factor(tissue, levels = tissuelevel),
         direction = factor(direction, levels = alllevels),
         label = gsub("_","\nvs. ", comparison)) 
head(allDEG)

# for suppl figures
DEGcontrol <- allDEG %>% 
  filter(grepl("control", comparison),
         !grepl("m.|early|extend|prolong", comparison))  %>%
  mutate(comparison = factor(comparison, levels = comparisonlevelscontrol))


DEGbldg <- allDEG %>% 
  filter(grepl("bldg", comparison),
         !grepl("m.|early|extend|prolong", comparison))  %>%
  mutate(comparison = factor(comparison, levels = comparisonlevelsbldg))  %>%
  drop_na()

DEGchar <- allDEG %>% 
  filter(comparison %in% comparisonlevelschar,
         !grepl("control|bldg", comparison)) %>%
  mutate(comparison = factor(comparison, levels = comparisonlevelschar))
```


```{r fig2-new, fig.width=7.25, fig.height=7.25}
a <- plot.volcano("hypothalamus", sexlevels,  "control_bldg") + 
  facet_wrap(~sex) + labs(subtitle = " ")
b <- makebargraph(DEGcontrol, "hypothalamus","DEGs w/ + LFC", 0, 5000, comparisonlabelscontrol) +
  labs(title = " ",
       subtitle = "Control versus all other reproductive and parental stages")

c <- makebargraph(DEGbldg, "hypothalamus", "DEGs w/ + LFC", 0, 490, comparisonlabelsbldg) +
  labs(subtitle = "Nest-building versus all other parental stages")
d <- makebargraph(DEGchar, "hypothalamus", NULL, 0, 1800, comparisonlabelscharnobldg) +
  labs(subtitle = "Comparison of sequential parental stages")

e <- makebargraph(DEGbldg, "pituitary", "DEGs w/ + LFC", 0, 2300, comparisonlabelsbldg)  

f <- makebargraph(DEGchar, "pituitary",NULL, 0, 1600, comparisonlabelscharnobldg) 

g <- makebargraph(DEGbldg, "gonad", "DEGs w/ + LFC", 0, 2900, comparisonlabelsbldg) 
h <- makebargraph(DEGchar, "gonad", NULL, 0, 1200, comparisonlabelscharnobldg) 

ab <- plot_grid(a,b,rel_widths = c(1,2.5), 
                labels = c("A Hypothalamus"), label_size = 8, hjust = 0)
cd <- plot_grid(c,d,rel_widths = c(1.1,1), align = "h")
ef <- plot_grid(e,f,rel_widths = c(1.1,1), align = "h",
                labels = c("B Pitutary"), label_size = 8 ,hjust = 0)
gh <- plot_grid(g,h,rel_widths = c(1.1,1), align = "h",
                labels = c("C Gonads"), label_size = 8, hjust = 0)

fig <- plot_grid(ab,cd,ef, gh, ncol = 1)
fig
```

## Save files

```{r write}
pdf(file="../figures/fig2-new-1.pdf", width=7, height=7)
plot(fig)
dev.off()

png("../figures/fig2-new-1.png", width = 7, height = 7, 
    units = 'in', res = 300)
plot(fig) 
dev.off()

sessionInfo()
```