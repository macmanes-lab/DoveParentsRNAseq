---
title: "GO"
output: md_document
---

# Exploring relationships between genes associated with mating behavior, lactation, parental care, and endocrine process in the hypothalamic-pituitary-gonad axis of reproction



1. Read in list of genes for GO terms: mating beahvior, lactating, parental care, and endocrine process.
2. Read in lists of differentially expressed genes for each transition (e.g. incubation day 17 to hatch) in each tissue (e.g. pituitary)
3. Join the two data frames
4. Print list of differentially expressed genes that correspond to each GO term, separated by either tissue or paretnal stage
5. Repeat the process for a list of candidate genes instead of GO terms.

## Made with these R packages

```{r setup}
library(tidyverse)
library(knitr)
library(kableExtra)

knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)

```

## GO terms

```{r, GOterms}

GO_path <- "../results/goterms/"   # path to the data
GO_files <- dir(GO_path, pattern = "*.txt") # get file names
GO_pathfiles <- paste0(GO_path, GO_files)

allGO <- GO_pathfiles %>%
  setNames(nm = .) %>% 
  map_df(~read_table(.x, col_types = cols(), col_names = FALSE), .id = "file_name") %>% 
  mutate(GO = sapply(strsplit(as.character(file_name),'../results/goterms/'), "[", 2)) %>% 
  mutate(GO = sapply(strsplit(as.character(GO),'.txt'), "[", 1)) %>% 
  mutate(gene = sapply(strsplit(as.character(X1), "[\\\\]|[^[:print:]]" ), "[", 2)) %>% 
  select(GO, gene)  %>%
  filter(gene != "Symbol") %>%
  distinct(GO,gene)  %>%
  mutate(gene = toupper(gene))
head(allGO)
```


## add candidate genes

```{r}

candidategenesslim <- c("OXT", "AVP", "GNRH1", "GNRHR", 
                    "AR",  "CYP19A1", 
                     "AVPR1A", "AVPR1B", "AVPR2","VIP",
                  "DRD1", "DRD2", 
                  "PRL", "PRLR",  
                    "ESR1","ESR2", "LBH",  
                   
                    "FOS", "JUN", "EGR1", "BDNF"
                      ) 


candidates <- candidategenesslim

candidates <- as.data.frame(candidates)
names(candidates)[1] <- "gene"
candidates$GO <- "candidategenes"
candidates <- candidates %>% select(GO, gene)

allGO <- rbind(candidates, allGO)
head(allGO)
```

## Differntially expressed genes by stage for each tissue

```{r DEGs}

DEG_path <- "../results/DEseq2/"   # path to the data
DEG_files <- dir(DEG_path, pattern = "*DEGs.csv") # get file names
DEG_pathfiles <- paste0(DEG_path, DEG_files)

DEGs <- DEG_pathfiles %>%
  setNames(nm = .) %>% 
  map_df(~read_csv(.x), .id = "file_name") %>%
  mutate(comparison = sapply(strsplit(as.character(file_name),'../results/DEseq2/*'), "[", 2)) %>% 
  mutate(comparison = sapply(strsplit(as.character(comparison),'_DEGs.csv'), "[", 1)) %>% 
  select(gene, comparison)
head(DEGs)
```

## GO and DEGs joined


```{r GO_DEGs}
GO_DEGs <- left_join(allGO, DEGs) %>%
  arrange(GO, gene) %>%
  group_by(GO, comparison) %>%
  summarize(genes = str_c(gene, collapse = ", ")) %>% 
  pivot_wider(names_from = comparison, values_from = genes) %>% 
  select(GO, 
         #contains("control_bldg"), 
         contains("bldg_lay"), contains("lay_inc.d3"),
         contains("inc.d3_inc.d9"), contains("inc.d9_inc.d17"), contains("inc.d17_hatch"),
         contains("hatch_n5"), contains("n5_n9")) %>%
  filter(GO %in% c("endocrineprocess", "lactation", 
                   "parentalbehavior", "matingbehavior", "reproduction",
                   "candidategenes", "cellcycleprocess")) %>% 
  map(~.x) %>%
  discard(~all(is.na(.x))) %>%
  map_df(~.x)
head(GO_DEGs)
```


## Tissue-specifiic differentially expressed genes 

```{r bytissue}
hyp <- GO_DEGs %>% select(GO, starts_with("male_hyp"), starts_with("female_hyp"))
pit <- GO_DEGs %>% select(GO, starts_with("male_pit"), starts_with("female_pit"))
gon <- GO_DEGs %>% select(GO, starts_with("male_gon"), starts_with("emale_gon"))

kable(hyp)  
# top GO therms for hyp:
# endocrine process, regulation of hormone levels,
# signal release # hormone secretion, # system process
# hormone transport, cell-cell signaling

kable(pit)
# endocrine process, mating behavior, system process,
# reproductive behavior, mating, regulation of blood pressure
# signal release, regulation of hormone levels

kable(gon)  
# endocrine process, regulation of blood pressure
# blood circutation, circulatory system
```


## Candidate genes

```{r}
candidate_DEGs <- left_join(candidates, DEGs) %>%
  arrange(GO, gene) %>%
  group_by(GO, comparison) %>%
  summarize(genes = str_c(gene, collapse = ", ")) %>%
  pivot_wider(names_from = comparison, values_from = genes) %>% 
  select(GO, contains("control_bldg"), contains("bldg_lay"), contains("lay_inc.d3"),
         contains("inc.d3_inc.d9"), contains("inc.d9_inc.d17"), contains("inc.d17_hatch"),
         contains("hatch_n5"), contains("n5_n9"))
candidate_DEGs <- as.data.frame(candidate_DEGs)

row.names(candidate_DEGs) <- candidate_DEGs$GO  
candidate_DEGs <- t(candidate_DEGs)
candidate_DEGs <- as.data.frame(candidate_DEGs)
kable(candidate_DEGs) 
```

```{r write}
write.csv(GO_DEGs, "../results/12_GO_DEGs.csv")
write.csv(hyp, "../results/12_GO_DEGs_hyp.csv")
write.csv(pit, "../results/12_GO_DEGs_pit.csv")
write.csv(gon, "../results/12_GO_DEGs_gon.csv")
```
