---
title: "05_DESeq_manipulation"
output: md_document
---

```{r setup, message=F, comment=FALSE, warning=FALSE, results='hide'}
library(tidyverse)
library(DESeq2)
library(cowplot)
library(factoextra)
library(Rtsne)

# load custom functions  
source("../R/functions.R") 
source("../R/themes.R") 

library(BiocParallel)
register(MulticoreParam(6))

knitr::opts_chunk$set(fig.path = '../figures/manipulation/', cache = TRUE)
```

## Manipulation data

```{r readfiles}
# import "colData" which contains sample information and "countData" which contains read counts
m.colData <- read.csv("../metadata/00_colData_manipluation.csv", header = T, row.names = 1)
m.countData <- read.csv("../results/00_countData_manipluation.csv", header = T, row.names = 1)
geneinfo <- read.csv("../metadata/00_geneinfo.csv", row.names = 1)

# set levels
m.colData$treatment <- factor(m.colData$treatment, levels = 
                              c("m.inc.d3",  "m.inc.d8",
                                "m.inc.d9", "m.inc.d17",
                                "prolong", "extend", "m.n2"))

m.colData$sextissue <- as.factor(paste(m.colData$sex, m.colData$tissue, sep = "_"))

m.colData$outcome <- ifelse(grepl("d3|d9|d17", m.colData$treatment), "end inc", 
                     ifelse(grepl("d8|n2", m.colData$treatment),"end hatch",
                     ifelse(grepl("prolong", m.colData$treatment),"prolong inc",
                     ifelse(grepl("extend", m.colData$treatment),"delay hatch", NA))))

summary(m.colData[c(7,3,4,5,8)])
```

## Run DESeq on all subsets of the data

```{r dds, cache = T}
dds.female_hypothalamus <- subsetDESeq(m.colData, m.countData, "female_hypothalamus")
dds.female_pituitary <- subsetDESeq(m.colData, m.countData, "female_pituitary" )
dds.female_gonad <- subsetDESeq(m.colData, m.countData, "female_gonad" )
dds.male_hypothalamus <- subsetDESeq(m.colData, m.countData, "male_hypothalamus" )
dds.male_pituitary <- subsetDESeq(m.colData, m.countData, "male_pituitary"  )
dds.male_gondad <- subsetDESeq(m.colData, m.countData, "male_gonad")
```

## volcano plots


```{r}

dds.hypothalamus <- subsetDESeq2(m.colData,  m.countData, c("female_hypothalamus","male_hypothalamus"))
dds.hypothalamus <- subsetDESeq2(m.colData,  m.countData, c("female_pituitary","male_pituitary"))
dds.hypothalamus <- subsetDESeq2(m.colData,  m.countData, c("female_gonad","male_gonad"))

```


```{r vsd, cache = T}

vsdh <- vst(dds.hypothalamus, blind=FALSE)
vsdp <- vst(dds.pituitary, blind=FALSE)
vsdg <- vst(dds.gonad, blind=FALSE)

vsdfh <- vst(dds.female_hypothalamus, blind=FALSE)
vsdfp <- vst(dds.female_pituitary, blind=FALSE)
vsdfg <- vst(dds.female_gonad, blind=FALSE)
vsdmh <- vst(dds.male_hypothalamus, blind=FALSE)
vsdmp <- vst(dds.male_pituitary, blind=FALSE)
vsdmg <- vst(dds.male_gondad, blind=FALSE)
```




